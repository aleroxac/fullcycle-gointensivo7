global:
  scrape_interval: 15s
  evaluation_interval: 15s



rule_files:
  - "alert.rules"



alerting:
  alertmanagers:
    - scheme: http
      static_configs:
        - targets:
            - "alertmanager:9093"



scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  - job_name: 'node'
    static_configs:
      - targets:
        - cadvisor:8080
        - node-exporter:9100
        - postgres-exporter:9187
        - k6-exporter:9091

  - job_name: 'blackbox'
    metrics_path: /probe
    params:
      module: [http_2xx]  # Look for a HTTP 200 response.
    static_configs:
      - targets:
        - http://gobook:8080/api/v1/health/liveness
        - http://gobook:8080/api/v1/health/readiness
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: "blackbox:9115"  # Blackbox exporter.
      - target_label: region
        replacement: "local"

  - job_name: "grafana-tempo"
    static_configs:
      - targets: ["grafana-tempo:3200"]

  - job_name: "otel-collector"
    static_configs:
      - targets: ["otel-collector:8888"]
      - targets: ["otel-collector:8889"]

  - job_name: "gobook"
    static_configs:
      - targets: ["gobook:8080"]
